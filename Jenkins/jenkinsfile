pipeline
{
	agent 
	{
		docker
		{
			image 'androidsdk/android-31:latest'
			reuseNode true
		}
		reuseNode true            
	}
	stages
	{ 
		stage('Build')
		{
			steps 
			{
				sh "echo 123"
			}
		}
		stage('Log the Jenkins Docker Ant Git and Java version info')
		{
			steps 
			{
				sh 'java -version'
				sh 'git --version'
			}
		}
        	stage('Unit Test')
		{
          		steps
			{
            			// Execute your Unit Test
            			sh './gradlew testStagingDebug'
          		}
        	}
		stage('Deploy to Heroku')
		{
           		agent
			{
               			docker
				{
                   			image 'cimg/base:stable'
			                   args '-u root'
               			}
           		}
           		steps
			{
               			sh '''
		   		curl https://cli-assets.heroku.com/install.sh | sh;
                   		heroku container:login
				heroku container:push web --app ymdbanking
                   		heroku container:release web --app ymdbanking
               			'''
	 		}
	       }
	}
	post 
	{
        	always 
		{
	            archiveArtifacts artifacts: 'build/libs/**/*.jar', fingerprint: true
	            junit 'build/reports/**/*.xml'
	        }
	}
}
